<%-include('../public/header.ejs') %>
<body style = "background-image: linear-gradient(35deg, gray, rgb(143, 142, 142)); background-attachment: fixed;">
<% let date_time = [];%>
<% let temperature = [];%>
<div class = "page-container">

    <h1 class = "text-center" style = "margin-top:10px"> Temperature in: <%= oras %></h1>
    <div class = "scrollable-container" style = "margin-top: 60px">
        <table class="custom-table text-center" style = "margin-top: 50; font-size: 18px; color: white;">
            <thead>
              <tr>
                <th scope="col">Date</th>
                <th scope="col">Time</th>
                <th scope="col">Temperature (Degrees Celsius)</th>
              </tr>
            </thead>
            <tbody>
                <% for (let i = 0; i < json_data.hourly.time.length; i++){%>
                    <% let date_string = json_data.hourly.time[i]%>
                    <% let month%>
                    <% let day%>
                    <% if(date_string.split('-')[1] == '09'){%>
                    <% month = 'September';%>
                    <% }%>
                    <% if(date_string.split('-')[1] == '10'){%>
                      <% month = 'October';%>
                      <% }%>
                    <% day = (date_string.split('-')[2]).split('T')[0];%>
                    <% if (date_string.split('T')[1] == '12:00' || date_string.split('T')[1] == '08:00' || date_string.split('T')[1] == '16:00' || date_string.split('T')[1] == '20:00'){%>
                    <tr>
                        <th>  <%= month + ' ' + day%> </th>
                        <% date_time.push(date_string.split('T')[1]);%>
                        <th>  <%= date_string.split('T')[1]%> </th>
                        <th>  <%= Math.floor(json_data.hourly.temperature_2m[i]) %></th>
                        <%temperature.push((json_data.hourly.temperature_2m[i])) %>
                    </tr>
                    <% }%>
                <% }%>
            </tbody>
          </table>
    </div>

    <div> 
      <canvas id="myChart" ></canvas>
    </div>
    

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  Chart.defaults.color = '#FFF';
  let labels = '<%- JSON.stringify(date_time);%>';
  labels = labels.split(',');
  for (let i = 0; i < labels.length; i++){
   labels[i] = labels[i].replace('["', '');
   labels[i] = labels[i].replace('"]', '');
   labels[i] = labels[i].replace('"', '');
   labels[i]= labels[i].replace('"', '');
   }

   let data = '<%- JSON.stringify(temperature);%>';
  data = data.split(',');
  for (let i = 0; i < data.length; i++){
    data[i] = data[i].replace('["', '');
    data[i] = data[i].replace('"]', '');
    data[i] = data[i].replace('"', '');
    data[i]= data[i].replace('"', '');
   }

  const ctx = document.getElementById('myChart');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Title',
        data: data,
        borderWidth: 1,
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
    
<% //console.log(date_time); %>
<% //console.log(temperature);%>


</body>


